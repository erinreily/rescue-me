<!DOCTYPE html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Hello world!</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script>
        function addPerson() {
            var num = $("#personForm form").length + 1;
            var formHtml = '<h4 id="persontitle' + num + '">Person ' + num + '</h4><form id="person' + num + '"><div class="form-group"><label for="name' + num + '">Full Name</label><input type="text" class="form-control" id="name' + num + '" placeholder="Full Name"></div><div class="form-group"><label for="age' + num + '">Age</label><input type="number" class="form-control" id="age' + num + '" placeholder="Age"></div><div class="form-group"><label for="gender' + num + '">Gender</label><select class="form-control" id="gender' + num + '"><option>Male</option><option>Female</option><option>Other</option></select></div><div class="form-group"><label for="comments' + num + '">Comments (optional)</label><input type="text" class="form-control" id="comments' + num + '" placeholder="Comments (optional)"></div></form><button style="margin-bottom:2%;margin-top:2%;" onclick="deletePerson(' + num + ')" class="btn btn-danger" id="deletePerson' + num + '"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span> Delete Person ' + num + '</button>'
            $("#personForm").append(formHtml);
        }
        function deletePerson(num) {
            $("#person" + num).remove();
            $("#deletePerson" + num).remove();
            $("#persontitle" + num).remove();
        }
        function addPet() {
            var num = $("#petForm form").length + 1;
            var formHtml = '<h4 id="pettitle' + num + '">Pet ' + num + '</h4><form id="pet' + num + '"><div class="form-group"><label for="type' + num + '">Type</label><select class="form-control" id="type' + num + '"><option>Cat</option><option>Dog</option><option>Bird</option><option>Rodent</option><option>Other</option></select></div><div class="form-group"><label for="breed' + num + '">Breed</label><input type="text" class="form-control" id="breed' + num + '" placeholder="Breed"></div><div class="form-group"><label for="petage' + num + '">Age</label><input type="number" class="form-control" id="petage' + num + '" placeholder="Age"></div></form><button style="margin-bottom:2%;margin-top:2%;" onclick="deletePet(' + num + ')" class="btn btn-danger" id="deletePet' + num + '"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span> Delete Pet ' + num + '</button>'
            $("#petForm").append(formHtml);
        }
        function deletePet(num) {
            $("#pet" + num).remove();
            $("#deletePet" + num).remove();
            $("#pettitle" + num).remove();
        }
        function addContact() {
            var num = $("#contactForm form").length + 1;
            var formHtml = '<h4 id="contacttitle' + num + '">Contact ' + num + '</h4><form id="contact' + num + '"><div class="form-group"><label for="email' + num + '">Email</label><input type="email" class="form-control" id="email' + num + '" placeholder="Email"></div><div class="form-group"><label for="phone' + num + '">Phone Number</label><input type="tel" class="form-control" id="phone' + num + '" placeholder="Phone Number"></div></form><button style="margin-bottom:2%;margin-top:2%;" onclick="deleteContact(' + num + ')" class="btn btn-danger" id="deleteContact' + num + '"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span> Delete Contact ' + num + '</button>';
            $("#contactForm").append(formHtml);
        }
        function deleteContact(num) {
            $("#contact" + num).remove();
            $("#deleteContact" + num).remove();
            $("#contacttitle" + num).remove();
        }
		function showValue(num) {
			var result = document.getElementById('result');     
			result.innerHTML = "<h3>"+num+"</h3>";
		}
        function submit() {
            var jsonData = {
                people: [],
                pets: [],
                contacts: [],
                severity: 1
            };
            $("#personForm form").each(function (index) {
                var name = $("#name" + (index + 1)).val();
                var age = $("#age" + (index + 1)).val();
                var gender = $("#gender" + (index + 1)).val().toLowerCase();
                var comments = $("#comments" + (index + 1)).val();
                jsonData.people.push({ name: name, gender: gender, age: age, comments: comments });
            });
            $("#petForm form").each(function (index) {
                var type = $("#type" + (index + 1)).val();
                var breed = $("#breed" + (index + 1)).val();
                var petage = $("#petage" + (index + 1)).val();
                jsonData.pets.push({ type: type, breed: breed, age: petage });
            });
            $("#contactForm form").each(function (index) {
                var email = $("#email" + (index + 1)).val();
                var phone = $("#phone" + (index + 1)).val();
                if (index = 0) {
                    var primary = true;
                }
                else {
                    primary = false;
                }
                jsonData.contacts.push({ phone: phone, email: email, primary: primary });
            });
            jsonData.severity = $("#severityForm").val();
            var lat;
            var lng;
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    lat = position.coords.latitude;
                    lng = position.coords.longitude;
                    jsonData.location = { latitude: lat, longitude: lng };
                });
            } else {
                x.innerHTML = "Geolocation is not supported by this browser.";
                jsonData.location = { latitude: 0, longitude: 0 };
            }
            console.log(jsonData);
            $.post("/api/requests",jsonData,
                function () {
                    console.log("Hey, it's a success!");
                },
                'json');
        }
    </script>
</head>
<body style="background-color:white; padding-bottom:10%; padding-top:0;">
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="index.html"><span class="glyphicon glyphicon-home" aria-hidden="true"></span></a>
                <h3 class="text-center">RescueMe</h3>
            </div>
        </div>
    </nav>
    <h1 class="text-center">Who needs rescuing? <br /><small>Enter all people and pets</small></h1>
    <div class="container" style="width:80%">
        <h3>People</h3>
        <div id="personForm"></div>
        <button style="margin-bottom:2%;margin-top:2%;" onclick="addPerson()" class="btn btn-default" id="addPerson"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add New Person</button>
    </div>
    <br />
    <div class="container" style="width:80%">
        <h3>Pets</h3>
        <div id="petForm"></div>
        <button style="margin-bottom:2%; margin-top:2%;" onclick="addPet()" class="btn btn-default" id="addPet"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add New Pet</button>
    </div>
    <br />
	<div class="container" style="width:80%">
        <h3>Severity</h3>
		<input type="range" id="severityForm" min="1" max="5" value="1" onchange="showValue(this.value);">
		<div id="result" style="height:40px;width:40px;"><h3>1</h3></div>
		<h4>1: No immediate forseeable danger.<br><br>
		2: Need to move within the next day.<br><br>
		3: Need to move within a few hours.<br><br>
		4: Need to be moved within the hour.<br><br>
		5. Immediate danger - only use if 911 is unavailable. </h4>
    </div>
    <br />
    <div class="container" style="width:80%">
        <h3>Primary Contact Information</h3>
        <div id="contactForm">
            <form id="contact1">
                <div class="form-group">
                    <label for="email1">Email</label>
                    <input type="email" class="form-control" id="email1" placeholder="Email">
                </div>
                <div class="form-group">
                    <label for="phone1">Phone Number</label>
                    <input type="tel" class="form-control" id="phone1" placeholder="Phone Number">
                </div>
            </form>
        </div>
        <button style="margin-bottom:2%;margin-top:2%;" onclick="addContact()" class="btn btn-default" id="addContact"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add Addl. Contact Information</button>
    </div>
    <div class="container-fluid" style="width:80%">
        <button onclick="submit()" style="margin-top:10px;" type="submit" class="btn btn-default">Submit</button>
    </div>
</body>